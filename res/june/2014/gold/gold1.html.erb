<div class="results">
  <div class="loader"></div>
  <span>Your string: <h4 class="submission-string"></h4></span>
  <img src>
  <h4 class="msg"></h4>
</div>
<script>
// Generated by CoffeeScript 1.6.3
(function() {
  var actor, actorList, actorMovie, actorName, movies, passed, submissionString, _, _i, _len, _ref;

  submissionString = "<Leonardo DiCaprio>[Gangs of New York] -> <Daniel Day-Lewis>[Lincoln] -> <Sally Field>[Forrest Gump] -> <Tom Hanks>[Apollo 13]";
  $("div.results h4.submission-string").text(submissionString);
  actorList = submissionString.split("->");

  movies = {};

  for (_i = 0, _len = actorList.length; _i < _len; _i++) {
    actor = actorList[_i];
    _ref = /^<(.*?)>\[(.*?)\]$/.exec(actor.trim()), _ = _ref[0], actorName = _ref[1], actorMovie = _ref[2];
    movies[actorMovie] = actorName;
  }

  passed = true;
  console.log(movies);
  $.each(Object.keys(movies), function(index, movieName) {
    $.ajax("http://www.omdbapi.com/?t=" + movieName).success(function(data) {
      actorName = movies[movieName];
      nextActor = movies[Object.keys(movies)[index+1]];
      if(typeof(nextActor) === "undefined"){
        nextActor = "Kevin Bacon";
      }
      data = $.parseJSON(data);
      console.log(data);
      console.log(index);
      console.log(actorName);
      console.log(nextActor);
      movieObj = $("<div class='movie'></div>").appendTo("div.results");
      $("<img src class='movie-poster' id='"+ movieName +"'>").appendTo(movieObj);
      actors = [actorName,nextActor];
      for(actor in actors){
        $("<span class='actor-name'>"+ actors[actor] +"</span>").appendTo(movieObj);
      }
      $("div.results .movie:last-child > img").attr("src", data.Poster);
      scenarioPass = (data.Actors.indexOf(actorName) >= 0) && //The actor specified is in the movie.
      (data.Actors.indexOf(nextActor) >= 0);  //The next actor is in the movie.
      if(!scenarioPass){
        movieObj.css("border", "2px solid red");
      }
      return passed = passed && scenarioPass;

    });
  });

  $(document).ajaxStop(function() {
    console.log(passed);
    var msg = $("div.results > h4.msg")
    if(passed){
      msg.addClass("pass");
      msg.text("Passed");
    }else{
      msg.addClass("fail");
      msg.text("Failed");
    }
    return $("div.results > div.loader").hide();
  });

}).call(this);
</script>
